<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Quick Start &mdash; dcctk 0.0.32 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Corpus Input" href="corpusReader.html" />
    <link rel="prev" title="Diachronic Character-based Corpus Toolkit" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> dcctk
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="corpusReader.html">2. Corpus Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="concordance.html">3. Corpus Search &amp; Concordancer</a></li>
<li class="toctree-l1"><a class="reference internal" href="sense.html">4. Sense Analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dcctk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">1. </span>Quick Start</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="quick-start">
<h1><span class="section-number">1. </span>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline"></a></h1>
<div class="cell markdown docutils container">
<p><a class="reference external" href="https://colab.research.google.com/drive/1wyw6IkKrZYsP0HNA51-d8b9O64Z_k18L?usp=sharing">Run on
Colab</a></p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dcctk.corpusReader</span> <span class="kn">import</span> <span class="n">PlainTextReader</span>
<span class="kn">from</span> <span class="nn">dcctk.concordancer</span> <span class="kn">import</span> <span class="n">Concordancer</span>
<span class="kn">from</span> <span class="nn">dcctk.corpus</span> <span class="kn">import</span> <span class="n">TextBasedCorpus</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Concordancer</span><span class="p">(</span><span class="n">PlainTextReader</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="concordance-search">1 Concordance Search</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cql</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&quot;君&quot; &quot;子&quot; [ char!=&quot;[，。、《》「」『』！？：；]&quot; ]</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">cql_search</span><span class="p">(</span><span class="n">cql</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num of results:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Num of results: 3570
&lt;Concord 雨，不及地尺而復。」{君子者}、孔子。孔子修之曰：&gt;
&lt;Concord 位，而反乎屠羊之肆。{君子聞}之曰：「甚矣哉！屠羊&gt;
&lt;Concord 或遇以死，或遇以生，{君子避}之，是亦傷人，故吏者&gt;
&lt;Concord 五伯有暴亂之謀。是故{君子不}責備于一人，方正而不&gt;
&lt;Concord 禽何？學者，所以求為{君子也}。求而不得者有矣，夫&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="concord-object">1.1 Concord Object</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_kwic</span><span class="p">()</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;雨，不及地尺而復。」君子者、孔子。孔子修之曰：&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_timestep</span><span class="p">()</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_timestep</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;time_range&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">-</span><span class="mi">205</span><span class="p">,</span> <span class="mi">220</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;captureGroups&#39;</span><span class="p">:</span> <span class="p">{},</span>
 <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="s1">&#39;君子者&#39;</span><span class="p">,</span>
 <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="s1">&#39;雨，不及地尺而復。」&#39;</span><span class="p">,</span>
 <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;02/論衡_說日.txt&#39;</span><span class="p">,</span>
  <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;Wang Chong&#39;</span><span class="p">,</span> <span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="s1">&#39;論衡&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">:</span> <span class="s1">&#39;說日&#39;</span><span class="p">},</span>
  <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;漢&#39;</span><span class="p">,</span> <span class="s1">&#39;ord&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;time_range&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">205</span><span class="p">,</span> <span class="mi">220</span><span class="p">]}},</span>
 <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">132</span><span class="p">),</span>
 <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="s1">&#39;、孔子。孔子修之曰：&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="semantic-similarity-with-anchibert">2 Semantic Similarity with AnchiBert</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">sample</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">from</span> <span class="nn">dcctk.embeddings</span> <span class="kn">import</span> <span class="n">AnchiBert</span>
<span class="kn">from</span> <span class="nn">dcctk.concordSimil</span> <span class="kn">import</span> <span class="n">ConcordSimil</span>

<span class="c1"># Jupyter settings for interactive visualizations</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">INLINE</span>
<span class="n">output_notebook</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">INLINE</span><span class="p">)</span>


<span class="c1"># Initialize bert model</span>
<span class="n">emb</span> <span class="o">=</span> <span class="n">AnchiBert</span><span class="p">()</span>

<span class="c1"># Sample 500 concordance lines of &quot;君子&quot;</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">results_samp</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ConcordSimil</span><span class="p">(</span><span class="n">concord_lines</span><span class="o">=</span><span class="n">results_samp</span><span class="p">,</span> <span class="n">bert_model</span><span class="o">=</span><span class="n">emb</span><span class="p">)</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Downloading</span> <span class="n">AnchiBert</span> <span class="n">model</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output stream stderr docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Downloading...
From: https://drive.google.com/uc?id=1uMlNJzilEhSigIcfjTjPdYOZL9IQfHNK
To: /content/AnchiBERT.zip
100%|██████████| 382M/382M [00:02&lt;00:00, 140MB/s]
</pre></div>
</div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loading</span> <span class="n">AnchiBERT</span> <span class="n">model</span> <span class="kn">from</span> <span class="nn">AnchiBERT</span><span class="o">/</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output stream stderr docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Some</span> <span class="n">weights</span> <span class="n">of</span> <span class="n">the</span> <span class="n">model</span> <span class="n">checkpoint</span> <span class="n">at</span> <span class="n">AnchiBERT</span><span class="o">/</span> <span class="n">were</span> <span class="ow">not</span> <span class="n">used</span> <span class="n">when</span> <span class="n">initializing</span> <span class="n">BertModel</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cls.predictions.transform.dense.bias&#39;</span><span class="p">,</span> <span class="s1">&#39;cls.predictions.transform.LayerNorm.weight&#39;</span><span class="p">,</span> <span class="s1">&#39;cls.predictions.transform.LayerNorm.bias&#39;</span><span class="p">,</span> <span class="s1">&#39;cls.predictions.bias&#39;</span><span class="p">,</span> <span class="s1">&#39;cls.predictions.transform.dense.weight&#39;</span><span class="p">,</span> <span class="s1">&#39;cls.predictions.decoder.weight&#39;</span><span class="p">]</span>
<span class="o">-</span> <span class="n">This</span> <span class="n">IS</span> <span class="n">expected</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">initializing</span> <span class="n">BertModel</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">checkpoint</span> <span class="n">of</span> <span class="n">a</span> <span class="n">model</span> <span class="n">trained</span> <span class="n">on</span> <span class="n">another</span> <span class="n">task</span> <span class="ow">or</span> <span class="k">with</span> <span class="n">another</span> <span class="n">architecture</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">initializing</span> <span class="n">a</span> <span class="n">BertForSequenceClassification</span> <span class="n">model</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">BertForPreTraining</span> <span class="n">model</span><span class="p">)</span><span class="o">.</span>
<span class="o">-</span> <span class="n">This</span> <span class="n">IS</span> <span class="n">NOT</span> <span class="n">expected</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">initializing</span> <span class="n">BertModel</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">checkpoint</span> <span class="n">of</span> <span class="n">a</span> <span class="n">model</span> <span class="n">that</span> <span class="n">you</span> <span class="n">expect</span> <span class="n">to</span> <span class="n">be</span> <span class="n">exactly</span> <span class="n">identical</span> <span class="p">(</span><span class="n">initializing</span> <span class="n">a</span> <span class="n">BertForSequenceClassification</span> <span class="n">model</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">BertForSequenceClassification</span> <span class="n">model</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Computing</span> <span class="n">bert</span> <span class="n">embeddings</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;83b6032703db4ab4a3a6c28447de3298&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="sorting-concordance-lines-based-on-bert-similarity">2.1 Sorting Concordance Lines based on Bert similarity</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">compare_base</span> <span class="o">=</span> <span class="n">results_samp</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">get_kwic</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">compare_base</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">semantic_sort</span><span class="p">(</span><span class="o">*</span><span class="n">compare_base</span><span class="p">,</span> <span class="n">is_traditional</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;絕之？懷惡而討不義，君子不予也。楚公子棄疾帥師&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;22e4f7a760ea450fa501abf58d514ad0&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[(&lt;Concord 絕之？懷惡而討不義，{君子不}予也。楚公子棄疾帥師&gt;, 1.0000000249452985),
 (&lt;Concord 直而俓，儉而好𠋤者，{君子不}與也。夸而無恥，彊而&gt;, 0.9443227685052723),
 (&lt;Concord ，拂乎正，沈而樂者，{君子不}聽也。」或問：「侍君&gt;, 0.942362932104167),
 (&lt;Concord 庸行翳路，沖沖而活，{君子不}貴也。」楚兩龔之絜，&gt;, 0.9412178065511391),
 (&lt;Concord ，『其身親為不善者，{君子不}入也』。今佛肸親以中&gt;, 0.9233915517589399),
 (&lt;Concord 皆在於凶德，雖得之，{君子不}貴也。君子則不然，言&gt;, 0.9127920194460578),
 (&lt;Concord 。不合乎先王之法者，{君子不}法也。」觀書者譬諸觀&gt;, 0.9127349625150739),
 (&lt;Concord 巧。邪生於多慾。是以{君子不}尚也。禮。與其奢也寧&gt;, 0.9035240450850379),
 (&lt;Concord 中道別去。爵級不進，{君子不}興。既濟：六雁俱飛，&gt;, 0.8991585156332778),
 (&lt;Concord 百姓也。故無功之師，{君子不}行；無用之地，聖王不&gt;, 0.8982093864739673)]
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="visualizing-bert-embeddings">2.2 Visualizing Bert embeddings</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">plot_embeddings</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="s2">&quot;m.time.label&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;0.35&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output display-data docutils container">
<img alt="_images/ad3270d4311b48a4f4d3267a1893ac9eb5bfaa5c.png" src="_images/ad3270d4311b48a4f4d3267a1893ac9eb5bfaa5c.png" />
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="hierarchical-clustering-of-instances">2.3 Hierarchical Clustering of Instances</p>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="exploring-optimal-number-of-clusters">2.3.1 Exploring Optimal Number of Clusters</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">hierarchical_clustering_explore</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">standardize_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="output display-data docutils container">
<img alt="_images/b11b6c8090a7c0a2562d23d4fc470302455dc5a7.png" src="_images/b11b6c8090a7c0a2562d23d4fc470302455dc5a7.png" />
</div>
<div class="output display-data docutils container">
<img alt="_images/ebb831a94e14b97a082f7bbb91b411d6db55dd3c.png" src="_images/ebb831a94e14b97a082f7bbb91b411d6db55dd3c.png" />
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="hierarchical-clustering-with-average-linkage-and-cosine-distance">2.3.2 Hierarchical Clustering with average linkage and
cosine distance</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># cs.hierarchical_clustering(threshold=.8, criterion=&#39;distance&#39;, visualize=False)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">hierarchical_clustering</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;maxclust&#39;</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           left keyword       right  ...  emb_id m.text.author cluster
0    能為表者，未之聞也。     君子時  則進，得之以義，何幸  ...       0           NaN       7
1    行也。山下有雷，頤；     君子以  慎言語，節飲食。觀我  ...       1           NaN      12
2    冬至絕事。冬至前後，     君子安  身靜體，百官絕事，不  ...       2           NaN      19
3    德潤身，心廣體胖，故     君子必  誠其意。《詩》云：「  ...       3           NaN       8
4    鑿也，不其然乎？是以     君子之  為論也，必原事類之宜  ...       4        Xu Gan       1
..          ...     ...         ...  ...     ...           ...     ...
495  從外來，驕其妻妾。由     君子觀  之，則人之所以求富貴  ...     495           NaN      13
496  者靈以化。於戲允哉！     君子辟  神也，觀彼威儀，遊燕  ...     496     Liu Xiang      11
497  婦；君之父母、従母；     君子子  為庶母慈己者。緦麻，  ...     497           NaN      11
498  子論其材曰：『有土之     君子也  ，有眾使也，有刑用也  ...     498           NaN       4
499  詩》云：「窈窕淑女，     君子好  逑。」言賢女能為君子  ...     499     Liu Xiang      19

[500 rows x 13 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">plot_cluster_results</span><span class="p">(</span><span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;0.35&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output display-data docutils container">
<img alt="_images/1a4a101de1561152b51f4ae833af6e3572f41f50.png" src="_images/1a4a101de1561152b51f4ae833af6e3572f41f50.png" />
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_sub</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">9</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num of results:&#39;</span><span class="p">,</span> <span class="n">df_sub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_sub</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="n">of</span> <span class="n">results</span><span class="p">:</span> <span class="mi">7</span>
</pre></div>
</div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           left keyword       right  ...  emb_id m.text.author cluster
122  死夫。裴回兩渠間兮，     君子獨  安居！」坐者皆泣。有  ...     122           NaN       9
136  ，人道福正而禍邪。故     君子內  正而外馴，每以下人。  ...     136    Yang Xiong       9
264  有喜色。門人曰：「聞     君子禍  至不懼，福至不喜。」  ...     264     Sima Qian       9
371  田，利見大人。九三：     君子終  日乾乾，夕惕若，厲，  ...     371           NaN       9
391  安，是以嬰得順也。聞     君子獨  立不慚於影。今孔子伐  ...     391           NaN       9
423  水而生，失水而死，故     君子常  懼而不敢失道。豪傑秉  ...     423           NaN       9
458  甘糟糠而安藜藿。「夫     君子非  不欲仕也。恥夸毗以求  ...     458           NaN       9

[7 rows x 13 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="sense-analysis">3 Sense Analysis</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dcctk.senseAnalysis</span> <span class="kn">import</span> <span class="n">SenseAnalysis</span>

<span class="n">dsa</span> <span class="o">=</span> <span class="n">SenseAnalysis</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="sense-distribution-across-time">3.1 Sense distribution across time</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsa</span><span class="o">.</span><span class="n">sense_distribution_raw</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">6</span>   <span class="mi">7</span>   <span class="mi">8</span>   <span class="mi">9</span>   <span class="mi">10</span>  <span class="mi">11</span>  <span class="mi">12</span>  <span class="mi">13</span>  <span class="mi">14</span>  <span class="mi">15</span>  <span class="mi">16</span>  <span class="mi">17</span>  <span class="mi">18</span>  <span class="mi">19</span>
<span class="mi">0</span>  <span class="mi">32</span>   <span class="mi">1</span>  <span class="mi">19</span>  <span class="mi">15</span>   <span class="mi">5</span>   <span class="mi">2</span>  <span class="mi">24</span>   <span class="mi">7</span>   <span class="mi">1</span>   <span class="mi">0</span>  <span class="mi">12</span>  <span class="mi">12</span>   <span class="mi">3</span>   <span class="mi">2</span>  <span class="mi">10</span>   <span class="mi">8</span>   <span class="mi">6</span>   <span class="mi">2</span>  <span class="mi">13</span>
<span class="mi">1</span>  <span class="mi">40</span>   <span class="mi">7</span>  <span class="mi">37</span>  <span class="mi">25</span>   <span class="mi">4</span>   <span class="mi">5</span>  <span class="mi">42</span>   <span class="mi">2</span>   <span class="mi">5</span>   <span class="mi">4</span>  <span class="mi">15</span>   <span class="mi">7</span>  <span class="mi">26</span>   <span class="mi">3</span>  <span class="mi">15</span>   <span class="mi">3</span>  <span class="mi">11</span>   <span class="mi">5</span>  <span class="mi">21</span>
<span class="mi">2</span>  <span class="mi">15</span>   <span class="mi">2</span>   <span class="mi">0</span>   <span class="mi">6</span>   <span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">7</span>   <span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsa</span><span class="o">.</span><span class="n">sense_distribution</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>         <span class="mi">1</span>         <span class="mi">2</span>         <span class="mi">3</span>   <span class="o">...</span>        <span class="mi">17</span>        <span class="mi">18</span>        <span class="mi">19</span>
<span class="mi">0</span>  <span class="mf">0.183908</span>  <span class="mf">0.005747</span>  <span class="mf">0.109195</span>  <span class="o">...</span>  <span class="mf">0.034483</span>  <span class="mf">0.011494</span>  <span class="mf">0.074713</span>
<span class="mi">1</span>  <span class="mf">0.144404</span>  <span class="mf">0.025271</span>  <span class="mf">0.133574</span>  <span class="o">...</span>  <span class="mf">0.039711</span>  <span class="mf">0.018051</span>  <span class="mf">0.075812</span>
<span class="mi">2</span>  <span class="mf">0.306122</span>  <span class="mf">0.040816</span>  <span class="mf">0.000000</span>  <span class="o">...</span>  <span class="mf">0.020408</span>  <span class="mf">0.020408</span>  <span class="mf">0.061224</span>

<span class="p">[</span><span class="mi">3</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">19</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsa</span><span class="o">.</span><span class="n">plot_sense_distribution</span><span class="p">(</span><span class="n">timelabel</span><span class="o">=</span><span class="s1">&#39;m.time.label&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
</pre></div>
</div>
<div class="output display-data docutils container">
<img alt="_images/90bc8b841d119d945dbe37b723e75b99827cc264.png" src="_images/90bc8b841d119d945dbe37b723e75b99827cc264.png" />
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsa</span><span class="o">.</span><span class="n">plot_sense_timeseries</span><span class="p">(</span><span class="n">clusters</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">timelabel</span><span class="o">=</span><span class="s1">&#39;m.time.label&#39;</span><span class="p">,</span> <span class="n">raw_count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
<div class="output display-data docutils container">
<img alt="_images/2b883c85abf14778e08fe5229c3e3e877f9f2312.png" src="_images/2b883c85abf14778e08fe5229c3e3e877f9f2312.png" />
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="dispersion">4 Dispersion</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">dcctk.dispersion</span> <span class="kn">import</span> <span class="n">Dispersion</span>
<span class="kn">from</span> <span class="nn">dcctk.corpusReader</span> <span class="kn">import</span> <span class="n">PlainTextReader</span>

<span class="n">dp</span> <span class="o">=</span> <span class="n">Dispersion</span><span class="p">(</span><span class="n">PlainTextReader</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Indexing</span> <span class="n">corpus</span> <span class="k">for</span> <span class="n">text</span> <span class="n">retrival</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;7b46c4b28eda467fa3d33803b02e8c00&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Indexing</span> <span class="n">corpus</span> <span class="k">for</span> <span class="n">concordance</span> <span class="n">search</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;258cae6db71241cb80a302abec91041b&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="dispersion-measures-of-a-character">4.1 Dispersion measures of a character</p>
<p>Corpus parts are separated text files.</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute on the full corpus</span>
<span class="n">dp</span><span class="o">.</span><span class="n">char_dispersion</span><span class="p">(</span><span class="n">char</span><span class="o">=</span><span class="s1">&#39;之&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mf">0.2022111504415149</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mf">0.20221136832606973</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="mf">0.9852650352870054</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mf">0.19438300669532335</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="mf">0.9263291584455613</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">1844</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute separate dispersion measures for each subcorpus (time-sliced)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">num_of_subcorp</span><span class="p">):</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">char_dispersion</span><span class="p">(</span><span class="n">char</span><span class="o">=</span><span class="s1">&#39;之&#39;</span><span class="p">,</span> <span class="n">subcorp_idx</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Occured </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> times in </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> texts</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Time</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Occured</span> <span class="mi">64665</span> <span class="n">times</span> <span class="ow">in</span> <span class="mi">732</span> <span class="n">texts</span>

<span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mf">0.12850786502690828</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mf">0.12850904069194602</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="mf">0.9773162825598201</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mf">0.09589034120820826</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="mf">0.9614052434775078</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">666</span><span class="p">}</span>


<span class="n">Time</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Occured</span> <span class="mi">100411</span> <span class="n">times</span> <span class="ow">in</span> <span class="mi">1049</span> <span class="n">texts</span>

<span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mf">0.177157904011686</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mf">0.17715848879560456</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="mf">0.9793139748213145</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mf">0.14783747591652752</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="mf">0.9465804731333193</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">1021</span><span class="p">}</span>


<span class="n">Time</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Occured</span> <span class="mi">44167</span> <span class="n">times</span> <span class="ow">in</span> <span class="mi">156</span> <span class="n">texts</span>

<span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mf">0.13409883701225642</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mf">0.13411539941898626</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="mf">0.9639771653228966</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mf">0.0886095001420331</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="mf">0.9702834801523642</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">156</span><span class="p">}</span>


<span class="n">Time</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Occured</span> <span class="mi">1365</span> <span class="n">times</span> <span class="ow">in</span> <span class="mi">1</span> <span class="n">texts</span>

<span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="mf">1.0000000000000002</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>


<span class="n">Time</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Occured</span> <span class="mi">0</span> <span class="n">times</span> <span class="ow">in</span> <span class="mi">5</span> <span class="n">texts</span>

<span class="p">{</span><span class="s1">&#39;DP&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;DPnorm&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;JuillandD&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;KLdivergence&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;RosengrenS&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="dispersion-measures-of-a-complex-form">4.2 Dispersion measures of a complex form</p>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="cql-search-result">4.2.1 CQL Search Result</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">dcctk.concordancer</span> <span class="kn">import</span> <span class="n">Concordancer</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Concordancer</span><span class="p">(</span><span class="n">PlainTextReader</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">corpus</span><span class="p">)</span>
<span class="n">cql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&quot;王&quot; &quot;者&quot;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">cql_search</span><span class="p">(</span><span class="n">cql</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num of results:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Indexing</span> <span class="n">corpus</span> <span class="k">for</span> <span class="n">text</span> <span class="n">retrival</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;33495329c94247f48c9703ca8dad391a&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Indexing</span> <span class="n">corpus</span> <span class="k">for</span> <span class="n">concordance</span> <span class="n">search</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="output display-data docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;version_major&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;version_minor&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="s2">&quot;991eb7a639ce4663b9eafdc092e29fca&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="output stream stdout docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Num of results: 1152
&lt;Concord 寧，明王之憂也。』故{王者}之於天下，猶一室之中&gt;
&lt;Concord 固辭曰：「昔陳嬰不受{王者}，以有老母也。今統內&gt;
&lt;Concord ，臣等誠竊惶懼。臣聞{王者}動設先置，止則交戟，&gt;
&lt;Concord 也。非王者則曷為謂之{王者}？王者無求，曰：是子&gt;
&lt;Concord 此一時也。五百年必有{王者}興，其間必有名世者。&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute separate dispersion measures for each subcorpus (time-sliced)</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">num_of_subcorp</span><span class="p">):</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">pattern_dispersion</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">subcorp_idx</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;range (%)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;num_of_texts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;corpus_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;corpus_size&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="nb">range</span>        <span class="n">DP</span>    <span class="n">DPnorm</span>  <span class="o">...</span>  <span class="nb">range</span> <span class="p">(</span><span class="o">%</span><span class="p">)</span>  <span class="n">num_of_texts</span>  <span class="n">corpus_size</span>
<span class="mi">0</span>    <span class="mi">117</span>  <span class="mf">0.730767</span>  <span class="mf">0.730774</span>  <span class="o">...</span>   <span class="mf">0.159836</span>           <span class="mi">732</span>      <span class="mi">1858228</span>
<span class="mi">1</span>    <span class="mi">206</span>  <span class="mf">0.510130</span>  <span class="mf">0.510132</span>  <span class="o">...</span>   <span class="mf">0.196378</span>          <span class="mi">1049</span>      <span class="mi">3938310</span>
<span class="mi">2</span>     <span class="mi">40</span>  <span class="mf">0.328366</span>  <span class="mf">0.328406</span>  <span class="o">...</span>   <span class="mf">0.256410</span>           <span class="mi">156</span>      <span class="mi">2097273</span>
<span class="mi">3</span>      <span class="mi">0</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="o">...</span>   <span class="mf">0.000000</span>             <span class="mi">1</span>       <span class="mi">458738</span>
<span class="mi">4</span>      <span class="mi">0</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="o">...</span>   <span class="mf">0.000000</span>             <span class="mi">5</span>           <span class="mi">50</span>

<span class="p">[</span><span class="mi">5</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">11</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell markdown docutils container">
<p class="rubric" id="sense-cluster">4.2.2 Sense Cluster</p>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">hierarchical_clustering</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;maxclust&#39;</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">d</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           left keyword       right  ...  emb_id m.text.author cluster
3    德潤身，心廣體胖，故     君子必  誠其意。《詩》云：「  ...       3           NaN       8
6    也；見敬愛者，人也。     君子必  在己者，不必在人者也  ...       6     Lu Bu-wei       8
95   其所貴。」此之謂也。     君子必  辯。凡人莫不好言其所  ...      95           NaN       8
173  ，知之，正之至也。故     君子必  存乎三至，弗至，斯有  ...     173           NaN       8
248  兆，而成之者無幾。故     君子必  立其志。《易》曰：「  ...     248        Xu Gan       8
268  必友，為人弟必悌。故     君子莫  若欲為惠君、忠臣、慈  ...     268           NaN       8
365  好色，此之謂自謙，故     君子必  慎其獨也！小人閑居為  ...     365           NaN       8
387  行安之，樂言之；故言     君子必  辯。小辯不如見端，見  ...     387           NaN       8
469  楊柳有路側之勢故也。     君子當  去二輕取四重：言重則  ...     469           NaN       8
488  民衣食之所以足也。故     君子莫  若審兼而務行之，為人  ...     488           NaN       8

[10 rows x 13 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell code docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute separate dispersion measures for each subcorpus (time-sliced)</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">num_of_subcorp</span><span class="p">):</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">pattern_dispersion</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">subcorp_idx</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">return_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;range (%)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;num_of_texts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;corpus_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;corpus_size&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<div class="output execute-result docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="nb">range</span>        <span class="n">DP</span>    <span class="n">DPnorm</span>  <span class="o">...</span>  <span class="nb">range</span> <span class="p">(</span><span class="o">%</span><span class="p">)</span>  <span class="n">num_of_texts</span>  <span class="n">corpus_size</span>
<span class="mi">0</span>      <span class="mi">4</span>  <span class="mf">0.990412</span>  <span class="mf">0.990421</span>  <span class="o">...</span>   <span class="mf">0.005464</span>           <span class="mi">732</span>      <span class="mi">1858228</span>
<span class="mi">1</span>      <span class="mi">2</span>  <span class="mf">0.998976</span>  <span class="mf">0.998980</span>  <span class="o">...</span>   <span class="mf">0.001907</span>          <span class="mi">1049</span>      <span class="mi">3938310</span>
<span class="mi">2</span>      <span class="mi">1</span>  <span class="mf">0.994173</span>  <span class="mf">0.994296</span>  <span class="o">...</span>   <span class="mf">0.006410</span>           <span class="mi">156</span>      <span class="mi">2097273</span>
<span class="mi">3</span>      <span class="mi">0</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="o">...</span>   <span class="mf">0.000000</span>             <span class="mi">1</span>       <span class="mi">458738</span>
<span class="mi">4</span>      <span class="mi">0</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="o">...</span>   <span class="mf">0.000000</span>             <span class="mi">5</span>           <span class="mi">50</span>

<span class="p">[</span><span class="mi">5</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">11</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Diachronic Character-based Corpus Toolkit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="corpusReader.html" class="btn btn-neutral float-right" title="2. Corpus Input" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Yongfu Liao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>